# cloud config
```
#cloud-config  
hostname: jumpnode.lab  
runcmd:  
- date > /opt/date
```
# Обновляем пакеты
```bash
sudo dnf update -y  
```

# Bind9
## Установка Bind9
```bash
sudo dnf install -y bind bind-utils  
rpm -qc bind

/etc/logrotate.d/named
/etc/named.conf
/etc/named.rfc1912.zones
/etc/named.root.key
/etc/rndc.conf
/etc/rndc.key
/etc/sysconfig/named
/var/named/named.ca
/var/named/named.empty
/var/named/named.localhost
/var/named/named.loopback
```
## Настройка Bind9
### Основной файл конфигов 
```bash
sudo vi /etc/named.conf

```bash
sudo vim /var/named/lab.zone

options {
        listen-on port 53 { localhost; 192.168.0.0/24; };
        listen-on-v6 port 53 { ::1; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        secroots-file   "/var/named/data/named.secroots";
        recursing-file  "/var/named/data/named.recursing";
        allow-query     { localhost; 192.168.0.0/24; };
        recursion yes;
        dnssec-validation yes;
        managed-keys-directory "/var/named/dynamic";
        geoip-directory "/usr/share/GeoIP";
        pid-file "/run/named/named.pid";
        session-keyfile "/run/named/session.key";
        include "/etc/crypto-policies/back-ends/bind.config";
};
logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

zone "." IN {
        type hint;
        file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";

zone "lab" IN {
    type master;
    file "/var/named/lab.zone";
};

zone "0.168.192.in-addr.arpa" IN {
    type master;
    file "/var/named/lab.reverse.zone";
};
```
### прямая зона
```bash
sudo vim /var/named/lab.zone

$TTL 86400
@   IN  SOA ns.croc-lab.com. root.croc-lab. (
            2024121101 ; Serial
            3600       ; Refresh
            1800       ; Retry
            1209600    ; Expire
            86400 )    ; Minimum TTL
;
@   IN  NS  ns.croc-lab.com.
ns  IN  A   192.168.0.4
;
nlb01   IN  A   192.168.0.20
nlb02   IN  A   192.168.0.36
app01   IN  A   192.168.0.52
app02   IN  A   192.168.0.68
;
dns       IN  CNAME ns
jumphost  IN  CNAME ns
jumpnode  IN  CNAME ns

```
### обратная зона
```bash
sudo vim /var/named/lab.reverse.zone
$TTL 86400
@   IN  SOA ns.croc-lab.com. root.croc-lab. (
            2024121101 ; Serial
            3600       ; Refresh
            1800       ; Retry
            1209600    ; Expire
            86400 )    ; Minimum TTL
;
@   IN  NS  ns.croc-lab.com.
4   IN  PTR ns.croc-lab.com.
20  IN  PTR nlb01.croc-lab.com.
36  IN  PTR nlb02.croc-lab.com.
52  IN  PTR app01.croc-lab.com.
68  IN  PTR app02.croc-lab.com.
;

dns   IN CNAME ns
jumphost   IN CNAME ns
jumpnode   IN CNAME ns
```
## resolv.conf
```bash
vi /etc/resolv.conf

# Generated by NetworkManager
search croc-lab.com lab
nameserver 192.168.0.4

```

```bash
sudo systemctl enable named
sudo systemctl start named
```
# Galera Arbitr

```bash
curl -sS https://downloads.mariadb.com/MariaDB/mariadb_repo_setup | bash
dnf makecache
dnf install -y galera-4

rpm -qi galera-4
Name        : galera-4
Version     : 26.4.20
```

![[Pasted image 20241225140343.png]]

```bash
sudo vi /etc/sysconfig/garb

# Copyright (C) 2012 Codership Oy
# This config file is to be sourced by garb service script.

# A comma-separated list of node addresses (address[:port]) in the cluster
 GALERA_NODES="192.168.0.52,192.168.0.68"

# Galera cluster name, should be the same as on the rest of the nodes.
 GALERA_GROUP="cluster"

# Optional Galera internal options string (e.g. SSL settings)
# see https://galeracluster.com/library/documentation/galera-parameters.html
# GALERA_OPTIONS="gcs.fc_limit=256"

# Log file for garbd. Optional, by default logs to syslog
 LOG_FILE="/var/log/garbd.log"

# Where to persist necessary data
# WORK_DIR=""
```

```bash
sudo touch /var/log/garbd.log 
sudo chmod 664 /var/log/garbd.log 
sudo chown nobody:nobody /var/log/garbd.log

sudo systemctl enable garb
sudo systemctl start garb
```